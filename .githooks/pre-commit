#!/bin/sh
# Pre-commit hook to format staged files with Biome and run checks

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json)$')

if [ -n "$STAGED_FILES" ]; then
  echo "Running Biome format on staged files..."
  echo "$STAGED_FILES" | xargs bunx biome format --write
  
  # Re-add the formatted files
  echo "$STAGED_FILES" | xargs git add
fi

# Run typecheck and tests
bun run precommit
if [ $? -ne 0 ]; then
  echo "Pre-commit checks failed. Please fix the issues before committing."
  exit 1
fi
