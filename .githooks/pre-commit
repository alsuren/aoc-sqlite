#!/bin/sh
# Pre-commit hook to format staged files with Biome and check TypeScript

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json)$')

if [ -n "$STAGED_FILES" ]; then
  echo "Running Biome format on staged files..."
  echo "$STAGED_FILES" | xargs bunx biome format --write
  
  # Re-add the formatted files
  echo "$STAGED_FILES" | xargs git add
fi

# Run TypeScript type checking
echo "Running TypeScript type check..."
bun run typecheck
if [ $? -ne 0 ]; then
  echo "TypeScript errors found. Please fix them before committing."
  exit 1
fi

# Run tests
echo "Running tests..."
bun run test
if [ $? -ne 0 ]; then
  echo "Tests failed. Please fix them before committing."
  exit 1
fi
